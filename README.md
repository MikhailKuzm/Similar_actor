# Поиск похожих лиц среди российских актёров и актрис

Программа выдаёт имя наиболее похожего актёра/актрисы по заданному фото. Используются эмбединги фотографий более 100 российских актёров и актрис, 
полученные через нейронную сеть ResNet18. Алгоритм KNN использован для предсказания наиболее похожего актёра/актрисы по заданным эмбедингам.

## Структура проекта
### Web Scrapping
Фотографии российских актёров и актрис были получены путём обработки html-страниц и get запросов к сайту https://www.kino-teatr.ru 
Всего было было собранно фотографий 63 актрис и 99 актёров. Фотографии были распределены по полу в папки men и women соответственно. Код сбора данных содержится в Data_scrapping.py.

### Предобработка данных
В Data_process.py происходит детекция лиц актёров на заданных фотографиях при помощи каскадов Хаара. Лицо вырезается из фотографии. Если на фото более двух лиц или фото
чёрно-белое, то оно не учитывается. Затем все вырезанные лица приводятся к размерности (200,150, 3). Где 3 - это RGB. Полученные фотографии прогоняются через 
нейронную сеть ResNet18, где были использованы предобученные веса pytorch. Последний слой нейронной сети был заменён на
линейный слой с выходом 128. Таким образом, прогнав каждое фото через ResNet18 получаем эмбединг фотографии размерностью 128. Такие эмбединги сохранены в female_embed.txt для
актрис и male_embed.txt для актёров. Соответетствующие метки актёров и актрис в виде integer были сохранены в female_lab.txt и male_lab.txt Для интерпритации имени актёров и актрис
в integer были созданы словари, сохранённые в catigories_female.pkl и catigories_male.pkl

### Обучение
Используя полученные массивы эмбедингов, были обучены две модели K-ближайших соседей: одна для мужчин, вторая для женщин.

### Предсказание
Функция predict из predict.py прнимает адрес места расположения фотографии и пол человека, на ней изображённого. Фотография приводится в вид, который ожидает получить ResNet18.
Полученные эмбединг затем подаётся на вход ранее обученной KNN. Выходом функции является имя актёра, чьё лицо больше всего похоже на лицо из заданной фотографии.

## Тестирования
Для проверки работоспособности модели из тестовой выборки была загружена фотография, показанная ниже. 
В итоге был получен ответ: "The most similar actor is АЛЁНА_САВАСТОВА". Актриса Алёна Савастова как раз и изображена на фото.
<p align="center">
  <img src="https://raw.githubusercontent.com/MikhailKuzm/Similar_actor/master/dataset/women/АЛЁНА_САВАСТОВА/2.jpeg" width="350" />
</p>

## Файлы
1. dataset - фотографии актёров и актрис.
2. Data_scrapping.py - web scrapping фотографий актёров и актрис
3. Data_process.py - обработка фотографий и получение их эмбедингов
4. training.py - обучение модели K-ближайших соседей
5. predict.py - предсказание имени наиболее похожего актёра
6. resnet18_weights.pth - предобученные веса ResNet18
7. male_lab.txt - категориальные метки для актёровв формате integer
8. female_lab.txt - категориальные метки для актрис в формате integer
9. male_embed.txt - эмбеддинги актёров
10. female_embed.tx  - эмбеддинги актрис
11. knn_women.pkl - модель K-ближайших соседей, предсказывающее имя наиболее похожей актрисы по эмбедингам
12. knn_men.pkl - модель K-ближайших соседей, предсказывающее имя наиболее похожего актёра по эмбедингам
13. catigories_male.pkl - словарь для перевода имён актёров в метки типа integer
14. catigories_female.pkl - словарь для перевода имён актрис в метки типа integer
15. haarcascade_frontalface_default.xml - каскады Хаара
